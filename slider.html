<!doctype html>
<html lang="en">
<head>
	<title>Circle Slider</title>

	<meta charset="utf-8">
	<meta name="robots" content="all" />
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<meta name="author" content="" />
	<meta name="copyright" content="" />
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

	<!--[if lte IE 8]>
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6/html5shiv.min.js"></script>
	<![endif]-->

	<!--[if lte IE 5]>
		<script type="text/javascript"> function handleError() { return true; } window.onerror = handleError; </script>
	<![endif]-->

	<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script type="text/javascript" src="assets/js/modernizr.js"></script>

	<link rel="stylesheet" type="text/css" href="assets/css/reset.css" />
</head>

<style type="text/css">
	body {
		background: url("images/background.png");
	}

	.sliderContainer {
		background: url("images/slider-back.png");
		background-repeat: no-repeat;
		background-position: center;
		position: absolute;
	}
</style>

<body>

<div id="mainContainer" style="position: relative; background: #252525; color: white;">
	<div class="sliderContainer" id="slider1">
		<img id="thumb" src="images/slider-thumb.png" style="top: 0; left: 0;" />
	</div>
</div>

<script type="text/javascript">
	function isTouchSupported() {
		var msTouchEnabled = window.navigator.msMaxTouchPoints;
		var generalTouchEnabled = "ontouchstart" in document.createElement("div");

		if (msTouchEnabled || generalTouchEnabled || Modernizr.touch)
			return true;

		return false;
	}

	var mobileSize = 630;
	var sizePercent = 60;
	var isMobile = false;
	var hasTouch = false;
	var currentThumb = null;

	function checkMobile() {
		var w = $(window).width();
		var h = $(window).height();

		isMobile = w <= mobileSize || h <= mobileSize;
	}

	// MAIN CODE
	$(document).ready(function() {
		checkMobile();
		placeMainContainer();
		positionSlider(1);
		setupEvents(1);

		$(window).resize(function() {
			checkMobile();
			placeMainContainer();
			positionSlider(1);
		});
	});

	function setupEvents(num) {
		var containerId = "#slider" + num;
		var container = $(containerId);
		var thumbId = "#slider" + num + " #thumb";
		var thumb = $(thumbId);

		hasTouch = isTouchSupported();
		var eventType = hasTouch ? "touchstart" : "mousedown";

        if (hasTouch) {
			$(document).on({
				touchstart: startDrag,
				touchmove: drag,
				touchend: endDrag
			});
        } else {
			thumb.bind(eventType, startDrag);
        }
	}

	function getEventLocation(e) {
		var out = { x: 0, y: 0};
		
		if (e.type == 'touchstart' || e.type == 'touchmove' ||
			e.type == 'touchend' || e.type == 'touchcancel')
		{
			var touch = e.originalEvent.touches[0] || e.originalEvent.changedTouches[0];
			out.x = touch.pageX;
			out.y = touch.pageY;
		} else if (e.type == 'mousedown' || e.type == 'mouseup' ||
				   e.type == 'mousemove' || e.type == 'mouseover' ||
				   e.type=='mouseout' || e.type=='mouseenter' || e.type=='mouseleave')
		{
			out.x = e.pageX;
			out.y = e.pageY;
		}

		return out;
    };

	function drag(event) {
		if (currentThumb == null) return;

		event.preventDefault();

		var location = getEventLocation(event);
		var pageX = location.x;
		var pageY = location.y;

		var containerOffset  = currentThumb.parent().offset();
		var containerSize = {
			width: currentThumb.parent().width(),
			height: currentThumb.parent().height()
		};

		var distanceFromCenter = {
			marginLeft: pageX - containerOffset.left - (containerSize.width / 2),
			marginTop: pageY - containerOffset.top - (containerSize.height / 2)
		};

		var angle = sanitizeAngle(toDegrees(Math.atan2(distanceFromCenter.marginLeft, -distanceFromCenter.marginTop)));
		var radius = containerSize.width / 2 - 15;
		currentThumb.css({
            marginTop: -Math.cos(toRadians(angle)) * radius + (containerSize.height / 2 - currentThumb.height() / 2),
            marginLeft: Math.sin(toRadians(angle)) * radius + (containerSize.width / 2 - currentThumb.width() / 2)
        });

		// console.info(event, "Drag!");

		return true;
	}

	function endDrag(event) {
		event.preventDefault();

		if (!hasTouch) {
			$(document).unbind("mousemove mouseup");
			$(document).unbind("mouseup");
			currentThumb.unbind("mouseup");
		}

		// console.info(event, "End drag!");

		if (event.target.id == "thumb")
			currentThumb = null;

		return true;
	}

	function startDrag(event) {
    	event.preventDefault();

    	if (event.target.id == "thumb")
    		currentThumb = $(event.target);

        if (!hasTouch) {
            $(document).mousemove(drag);
            $(document).mouseup(endDrag);
            currentThumb.mouseup(endDrag);
        }

        // console.info(event, "Start drag!");

		return true;
    }

	function toRadians(degrees) {
        return degrees * (Math.PI / 180);
    }

    function toDegrees(radians) {
        return radians * 180 / Math.PI;
    }

    function sanitizeAngle(degrees) {
        return (degrees < 0) ? 360 + (degrees % -360) : degrees % 360;
    }

	function positionSlider(num) {
		var id = "#slider" + num;

		var minSize = 350;

		var marTop = 15;
		var marLeft = 15;
		
		var contW = $("#mainContainer").width();
		var contH = $("#mainContainer").height();

		if (!isMobile) {
			var thisW = contW - 2 * marLeft;
			var thisH = contH - 2 * marTop;
		} else {
			var thisW = minSize;
			var thisH = minSize;

			marTop = contH / 2 - thisH / 2;
			marLeft = contW / 2 - thisW / 2;
		}

		var thumbW = 12 / 100 * thisW;
		var thumbH = 12 / 100 * thisH;

		$(id).css("top", marTop + "px");
		$(id).css("left", marLeft + "px");
		$(id).css("width", thisW + "px");
		$(id).css("height", thisH + "px");
		$(id).css("background-size", thisW + "px " + thisH + "px");

		var thumbX = thisW / 2 - thumbW / 2;
		var thumbY = -15;

		$(id + " #thumb").css({
				width: thumbW + "px",
				height: thumbH + "px",
				marginTop: thumbY + "px",
				marginLeft: thumbX + "px"
		});
	}

	function placeMainContainer() {
		var w = $(window).width();
		var h = $(window).height();

		if (w > h) {
			var sliderH = Math.round(sizePercent / 100 * h);
			var sliderW = sliderH;
		} else {
			var sliderW = Math.round(sizePercent / 100 * w);
			var sliderH = sliderW;
		}

		var marTop = h / 2 - sliderH / 2;
		var marLeft = w / 2 - sliderW / 2;

		if (isMobile) {
			sliderW = w;
			sliderH = h;
			marTop = 0;
			marLeft = 0;
		}

		$("#mainContainer").css("width", sliderW + "px");
		$("#mainContainer").css("height", sliderH + "px");

		$("#mainContainer").css("margin-top", marTop + "px");
		$("#mainContainer").css("margin-left", marLeft + "px");
	}
</script>

</body>
</html>